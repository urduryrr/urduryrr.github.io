<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2023-08-02" />

<title>bla</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="section-header">



<h1 class="title toc-ignore">bla</h1>
<h4 class="date">2023-08-02</h4>

</div>


<pre class="r"><code>library(shiny)
library(leaflet)
library(leaflet.extras)  # Make sure you have this package installed
library(shinyWidgets)
library(usethis)
library(readr)
library(tidyverse)</code></pre>
<pre><code>## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
## ✔ dplyr     1.1.2     ✔ purrr     1.0.1
## ✔ forcats   1.0.0     ✔ stringr   1.5.0
## ✔ ggplot2   3.4.2     ✔ tibble    3.2.1
## ✔ lubridate 1.9.2     ✔ tidyr     1.3.0
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
<pre class="r"><code>setwd(&quot;~/MappingData/LiteratureMaps/ForR&quot;)

library(sf)</code></pre>
<pre><code>## Linking to GEOS 3.11.0, GDAL 3.5.2, PROJ 9.0.1; sf_use_s2() is TRUE</code></pre>
<pre class="r"><code>library(htmltools)
library(leaflet)
library(tidyverse)
library(htmlwidgets)

# Reading in data from all papers (first round)

adalA&lt;- read_sf(dsn=&quot;Adalsteinsd1980Absence2.kml&quot;)
adalA &lt;- adalA %&gt;%mutate(type=&quot;Absence&quot;, source=&quot;Aðalsteinsdóttir og Garðarsson (1980)&quot;, 
                         data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;, year=1980, 
                         research=&quot;Bottom sample&quot;)
adalA &lt;- st_transform(adalA[,-c(1:11)], crs=8088)

adalP &lt;- read_sf(dsn=&quot;Adalsteinsd1980Presence.gpkg&quot;)
adalP &lt;- adalP %&gt;%mutate(type=&quot;Presence&quot;, source=&quot;Aðalsteinsdóttir og Garðarsson (1980)&quot;, 
                         data=&quot;Literature&quot;, group=&quot;Literature: Presence&quot;, year=1980, 
                         research=&quot;Bottom sample&quot;)

gunnP &lt;- read_sf(dsn=&quot;Gunnarsson1977Presence.gpkg&quot;)
gunnP &lt;- gunnP %&gt;%mutate(type=&quot;Presence&quot;, source=&quot;Gunnarsson (1977)&quot;, data=&quot;Literature&quot;, 
                         group=&quot;Literature: Presence&quot;, year=1977, research=&quot;Dive&quot;)

iskP &lt;- read_sf(dsn=&quot;IsKalk2013Presence.gpkg&quot;)
iskP &lt;- iskP %&gt;%mutate(type=&quot;Presence&quot;, source=&quot;Thors (2013)&quot;, data=&quot;Literature&quot;, 
                       group=&quot;Literature: Presence&quot;, year=2013, research=&quot;Video survey&quot;)
iskP &lt;- iskP[,-c(1:13)]
st_geometry(iskP) &lt;- &quot;geometry&quot;

iskA &lt;- read_sf(dsn=&quot;IsKalk2013Absence.gpkg&quot;)
iskA &lt;- iskA %&gt;%mutate(type=&quot;Absence&quot;, source=&quot;Thors (2013)&quot;, data=&quot;Literature&quot;, 
                       group=&quot;Literature: Absence&quot;, year=2013, research=&quot;Video survey&quot;)
iskA &lt;- iskA[,-c(1:13)]
st_geometry(iskA) &lt;- &quot;geometry&quot;

natA &lt;- read_sf(dsn=&quot;NatVest2016Absence.csv&quot;)
natA &lt;- natA %&gt;%mutate(type=&quot;Absence&quot;, source=&quot;Gallo (2016)&quot;, data=&quot;Literature&quot;, 
                       group=&quot;Literature: Absence&quot;, year=2016, research=&quot;Bottom sample&quot;)
natA &lt;- natA[,-1]

natP &lt;- read_sf(dsn=&quot;NatVest2016Presence.csv&quot;)
natP &lt;- natP %&gt;%mutate(type=&quot;Presence&quot;, source=&quot;Gallo (2016)&quot;, data=&quot;Literature&quot;, 
                       group=&quot;Literature: Presence&quot;, year=2016, research=&quot;Bottom sample&quot;)
natP &lt;- natP[,-1]

th80P &lt;- read_sf(dsn=&quot;Thors1980Presence.gpkg&quot;)
th80P &lt;- th80P %&gt;%mutate(type=&quot;Presence&quot;, source=&quot;Thors og Helgadóttir (1980)&quot;, data=&quot;Literature&quot;, 
                         group=&quot;Literature: Presence&quot;, year=1980, research=&quot;Bottom sample&quot;)
th80P &lt;- th80P[,-c(1:13)]
st_geometry(th80P) &lt;- &quot;geometry&quot;

th80A &lt;- read_sf(dsn=&quot;Thors1980Absence.gpkg&quot;)
th80A &lt;- th80A %&gt;%mutate(type=&quot;Absence&quot;, source=&quot;Thors og Helgadóttir (1980)&quot;, data=&quot;Literature&quot;, 
                         group=&quot;Literature: Absence&quot;, year=1980, research=&quot;Bottom sample&quot;)
th80A &lt;- th80A[,-c(1:13)]
st_geometry(th80A) &lt;- &quot;geometry&quot;

th18PL &lt;- read_sf(dsn=&quot;Thors2018PresenceLine.gpkg&quot;)
th18PL &lt;- th18PL %&gt;%mutate(type=&quot;Presence&quot;, source=&quot;Thors (2018)&quot;, data=&quot;Literature&quot;, 
                           group=&quot;Literature: Presence&quot;, year=2018, research=&quot;Multibeam echosample&quot;)
th18PL &lt;- th18PL[,-c(1:13)]
st_geometry(th18PL) &lt;- &quot;geometry&quot;

th18PP &lt;- read_sf(dsn=&quot;Thors2018PresencePolygon.gpkg&quot;)
th18PP &lt;- th18PP %&gt;%mutate(type=&quot;Presence&quot;, source=&quot;Thors (2018)&quot;, data=&quot;Literature&quot;, 
                           group=&quot;Literature: Presence&quot;, year=2018, research=&quot;Multibeam echosample&quot;)
th18PP &lt;- th18PP[,-c(1:13)]
st_geometry(th18PP) &lt;- &quot;geometry&quot;

# Maybe not use Valliant absences since it&#39;s &lt;20%

valA &lt;- read_sf(dsn=&quot;Valliant2020Absence.csv&quot;)
valA &lt;- valA %&gt;%mutate(type=&quot;Absence&quot;, source=&quot;Valliant (2020)&quot;, data=&quot;Literature&quot;, 
                       group=&quot;Literature: Absence&quot;, year=2020, research=&quot;Dive&quot;)
valA &lt;- valA[,-1]

valP &lt;- read_sf(dsn=&quot;Valliant2020Presence.csv&quot;)
valP &lt;- valP %&gt;%mutate(type=&quot;Presence&quot;, source=&quot;Valliant (2020)&quot;, data=&quot;Literature&quot;, 
                       group=&quot;Literature: Presence&quot;, year=2020, research=&quot;Dive&quot;)
valP &lt;- valP[,-1]

# Second round of papers

eiretalA &lt;- read_sf(dsn=&quot;EirikssonEtAl2012Absence4326.kml&quot;)
eiretalA &lt;- eiretalA %&gt;% mutate(type=&quot;Absence&quot;, source=&quot;Eiríksson et al. (2012)&quot;, 
                                data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;, 
                                year=2012, research=&quot;Bottom sample&quot;)
eiretalA &lt;- st_transform(eiretalA[,-c(1:16)], crs=8088)

eiretalP &lt;- read_sf(dsn=&quot;EirikssonEtAl2012Presence4326.kml&quot;)
eiretalP &lt;- eiretalP %&gt;% mutate(type=&quot;Presence&quot;, source=&quot;Eiríksson et al. (2012)&quot;, 
                                data=&quot;Literature&quot;, group=&quot;Literature: Presence&quot;,
                                year=2012, research=&quot;Bottom sample&quot;)
eiretalP &lt;- st_transform(eiretalP[,-c(1:17)], crs=8088)

eirtho03A &lt;- read_sf(dsn=&quot;EirikssonThorisson2003Absence4326.kml&quot;)
eirtho03A &lt;- eirtho03A %&gt;% mutate(type=&quot;Absence&quot;, source=&quot;Eiríksson og Þórisson (2003)&quot;, 
                                  data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;,
                                  year=2003, research=&quot;Bottom sample&quot;)
eirtho03A &lt;- st_transform(eirtho03A[,-c(1:15)], crs=8088)

eirtho04A &lt;- read_sf(dsn=&quot;EirikssonThorisson2004Absence4326.kml&quot;)
eirtho04A &lt;- eirtho04A %&gt;% mutate(type=&quot;Absence&quot;, source=&quot;Eiríksson og Þórisson (2004)&quot;, 
                                  data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;,
                                  year=2004, research=&quot;Bottom sample&quot;)
eirtho04A &lt;- st_transform(eirtho04A[,-c(1:16)], crs=8088)

eirtho04P &lt;- read_sf(dsn=&quot;EirikssonThorisson2004Presence4326.kml&quot;)
eirtho04P &lt;- eirtho04A %&gt;% mutate(type=&quot;Presence&quot;, source=&quot;Eiríksson og Þórisson (2004)&quot;, 
                                  data=&quot;Literature&quot;, group=&quot;Literature: Presence&quot;,
                                  year=2004, research=&quot;Bottom sample&quot;)
eirtho04P &lt;- st_transform(eirtho04P, crs=8088)

eirtho12A &lt;- read_sf(dsn=&quot;EirikssonThorisson2012Absence4326.kml&quot;)
eirtho12A &lt;- eirtho12A %&gt;% mutate(type=&quot;Absence&quot;, source=&quot;Eiríksson og Þórisson (2012)&quot;, 
                                  data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;,
                                  year=2012, research=&quot;Bottom sample&quot;)
eirtho12A &lt;- st_transform(eirtho12A[,-c(1:15)], crs=8088)

eirtho13A &lt;- read_sf(dsn=&quot;EirikssonThorisson2013Absence4326.kml&quot;)
eirtho13A &lt;- eirtho13A %&gt;% mutate(type=&quot;Absence&quot;, source=&quot;Eiríksson og Þórisson (2013)&quot;, 
                                  data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;,
                                  year=2013, research=&quot;Bottom sample&quot;)
eirtho13A &lt;- st_transform(eirtho13A[,-c(1:15)], crs=8088)

gallo15A &lt;- read_sf(dsn=&quot;Gallo2015Absence4326.kml&quot;)
gallo15A &lt;- gallo15A %&gt;% mutate(type=&quot;Absence&quot;, source=&quot;Gallo (2015)&quot;, 
                                data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;,
                                year=2015, research=&quot;Bottom sample&quot;)
gallo15A &lt;- st_transform(gallo15A[,-c(1:15)], crs=8088)

gallo21A &lt;- read_sf(dsn=&quot;Gallo2021Absence.kml&quot;)
gallo21A &lt;- gallo21A %&gt;% mutate(type=&quot;Absence&quot;, source=&quot;Gallo (2021)&quot;, 
                                data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;,
                                year=2021, research=&quot;Bottom sample&quot;)
gallo21A &lt;- st_transform(gallo21A[,-c(1:15)], crs=8088)

gallo21P &lt;- read_sf(dsn=&quot;Gallo2021Presence.kml&quot;)
gallo21P &lt;- gallo21P %&gt;% mutate(type=&quot;Presence&quot;, source=&quot;Gallo (2021)&quot;, 
                                data=&quot;Literature&quot;, group=&quot;Literature: Presence&quot;,
                                year=2021, research=&quot;Bottom sample&quot;)
gallo21P &lt;- st_transform(gallo21P[,-c(1:14)], crs=8088)

galloetal21A &lt;- read_sf(dsn=&quot;GalloEtAl2021Absence.kml&quot;)
galloetal21A &lt;- galloetal21A %&gt;% mutate(type=&quot;Absence&quot;, source=&quot;Gallo et al. (2021)&quot;, 
                                        data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;,
                                        year=2021, research=&quot;Bottom sample&quot;)
galloetal21A &lt;- st_transform(galloetal21A[,-c(1:14)], crs=8088)

helgA &lt;- read_sf(dsn=&quot;HelgasonEtAl2019Absence4326.kml&quot;)
helgA &lt;- helgA %&gt;% mutate(type=&quot;Absence&quot;, source=&quot;Helgason et al. (2019)&quot;, 
                          data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;,
                          year=2019, research=&quot;Bottom sample&quot;)
helgA &lt;- st_transform(helgA[,-c(1:15)], crs=8088)

leuA &lt;- read_sf(dsn=&quot;Leu2010Absence.kml&quot;)
leuA &lt;- leuA %&gt;% mutate(type=&quot;Absence&quot;, source=&quot;Leu (2010)&quot;, data=&quot;Literature&quot;, 
                        group=&quot;Literature: Absence&quot;, year=2010, research=&quot;Video survey&quot;)
leuA &lt;- st_transform(leuA[,-c(1:11)], crs=8088)

leuP &lt;- read_sf(dsn=&quot;Leu2010Presence.kml&quot;)
leuP &lt;- leuP %&gt;% mutate(type=&quot;Presence&quot;, source=&quot;Leu (2010)&quot;, data=&quot;Literature&quot;, 
                        group=&quot;Literature: Presence&quot;, year=2010, research=&quot;Video survey&quot;)
leuP &lt;- st_transform(leuP[,-c(1:11)], crs=8088)

# Third round of papers

## NatAust er grófunnið
natAustP &lt;- read_sf(dsn=&quot;Thors2019Presence.kml&quot;)
natAustP &lt;- natAustP %&gt;% mutate(type=&quot;Presence&quot;, source=&quot;Náttúrufræðistofa Austurlands (2019)&quot;, 
                                data=&quot;Literature&quot;, group=&quot;Literature: Presence&quot;,
                                year=2019, research=&quot;Video survey&quot;)
natAustP &lt;- st_transform(natAustP[,-c(1:12)], crs=8088)

natAustA &lt;- read_sf(dsn=&quot;Thors2019Absence.kml&quot;)
natAustA &lt;- natAustA %&gt;% mutate(type=&quot;Absence&quot;, source=&quot;Náttúrufræðistofa Austurlands (2019)&quot;, 
                                data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;,
                                year=2019, research=&quot;Video survey&quot;)
natAustA &lt;- st_transform(natAustA[,-c(1:11)], crs=8088)

thors11A &lt;- read_sf(dsn=&quot;Thors2011Absence.kml&quot;)
thors11A &lt;- thors11A %&gt;% mutate(type=&quot;Absence&quot;, source=&quot;Thors (2011)&quot;, 
                                data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;,
                                year=2011, research=&quot;Video survey&quot;)
thors11A &lt;- st_transform(thors11A[,-c(1:11)], crs=8088)

thors11P &lt;- read_sf(dsn=&quot;Thors2011Presence.kml&quot;)
thors11P &lt;- thors11P %&gt;% mutate(type=&quot;Presence&quot;, source=&quot;Thors (2011)&quot;, 
                                data=&quot;Literature&quot;, group=&quot;Literature: Presence&quot;,
                                year=2011, research=&quot;Video survey&quot;)
thors11P &lt;- st_transform(thors11P[,-c(1:11)], crs=8088)

heletalA &lt;- read_sf(dsn=&quot;HelgasonEtAl2017Absence.kml&quot;)
heletalA &lt;- heletalA %&gt;% mutate(type=&quot;Absence&quot;, source=&quot;Helgason et al. (2017)&quot;, 
                                data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;,
                                year=2017, research=&quot;Bottom sample&quot;)
heletalA &lt;- st_transform(heletalA[,-c(1:15)], crs=8088)

johetalA &lt;- read_sf(dsn=&quot;JohannsdottirEtAl2017Absence.kml&quot;)
johetalA &lt;- johetalA %&gt;% mutate(type=&quot;Absence&quot;, source=&quot;Jóhannsdóttir et al. (2017)&quot;, 
                                data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;,
                                year=2017, research=&quot;Bottom sample&quot;)
johetalA &lt;- st_transform(johetalA[,-c(1:15)], crs=8088)

johstefgud15A &lt;- read_sf(dsn=&quot;JohStefGud2015Absence.kml&quot;)
johstefgud15A &lt;- johstefgud15A %&gt;% mutate(type=&quot;Absence&quot;, 
                                          source=&quot;Jóhannsdóttir, Stefánsson og Guðmundsdóttir (2015)&quot;, 
                                          data=&quot;Literature&quot;, group=&quot;Literature: Absence&quot;,
                                          year=2015, research=&quot;Bottom sample&quot;)
johstefgud15A &lt;- st_transform(johstefgud15A[,-c(1:15)], crs=8088)

johstefgud15P &lt;- read_sf(dsn=&quot;JohStefGud2015Presence.kml&quot;)
johstefgud15P &lt;- johstefgud15P %&gt;% mutate(type=&quot;Presence&quot;, 
                                          source=&quot;Jóhannsdóttir, Stefánsson og Guðmundsdóttir (2015)&quot;, 
                                          data=&quot;Literature&quot;, group=&quot;Literature: Presence&quot;,
                                          year=2015, research=&quot;Bottom sample&quot;)
johstefgud15P &lt;- st_transform(johstefgud15P[,-c(1:15)], crs=8088)

# Adding diver maps

setwd(&quot;~/MappingData/DiverMaps/ForR&quot;)

simbi &lt;- read_sf(dsn=&quot;SimbiPresence.kml&quot;)
simbi &lt;- simbi %&gt;% mutate(type=&quot;Presence&quot;, source=&quot;Sveinbjörn Hjálmarsson: Diver&quot;, 
                          data=&quot;Divers&quot;, group=&quot;Divers&quot;, year=NA, research=&quot;Dive&quot;)
simbi &lt;- st_transform(simbi[,-c(1:11)], crs=8088)

divers &lt;- read_sf(dsn=&quot;DivMrlHighAcc.kml&quot;)
divers &lt;- divers%&gt;% mutate(type=&quot;Presence&quot;, data=&quot;Divers&quot;, 
                           source=paste0(Name, &quot;: Diver&quot;), group=&quot;Divers&quot;,
                           year=NA, research=&quot;Dive&quot;)
divers &lt;- filter(divers, Name!=&quot;Sveinbjörn Hjálmarsson&quot;)
divers &lt;- filter(divers, Name!=&quot;Einar Pétur Jónsson&quot;)
divers &lt;- st_transform(divers[,-c(1:11)], crs=8088)

einarp &lt;-read_sf(dsn=&quot;DivMrlHighAcc.kml&quot;)
einarp &lt;- einarp%&gt;% mutate(type=&quot;Presence&quot;, data=&quot;Divers&quot;, 
                           source=paste0(Name, &quot;: Diver&quot;), group=&quot;Divers&quot;,
                           year=NA, research=&quot;Dive&quot;)
einarp &lt;- filter(einarp, Name==&quot;Einar Pétur Jónsson&quot;)
einarp &lt;- st_transform(einarp[,-c(1:11)], crs=8088)
einarp &lt;- st_zm(einarp)

# Survey data

setwd(&quot;~/MappingData/SurveyMaps/ForR&quot;)

urchin &lt;- read_sf(dsn=&quot;UrchinSurvey.kml&quot;, crs=4326)
urchin &lt;- urchin[!with(urchin,is.na(botngrd)&amp; is.na(busv)),]
urchin$rownumber &lt;- 1:56

urchin1&lt;-urchin %&gt;% filter(grepl(&quot;kóralþörungar&quot;, urchin$busv, ignore.case = T))
urchin2&lt;-urchin %&gt;% filter(grepl(&quot;kóralþörungar&quot;, urchin$botngrd, ignore.case = T))
urchinP &lt;- rbind(urchin1, urchin2)

urchinP &lt;- urchinP[-1,]
urchinA &lt;- urchin[-urchinP$rownumber,]
## Need to check if research type is correct
urchinP &lt;- urchinP%&gt;% mutate(type=&quot;Presence&quot;, data=&quot;Surveys&quot;, source=&quot;Urchin survey&quot;, 
                             group=&quot;Surveys: Presence&quot;, year=NA, research=&quot;Bottom sample&quot;)
urchinP &lt;- st_transform(urchinP[,-c(1:20, 22)], crs=8088)

urchinA &lt;- urchinA%&gt;% mutate(type=&quot;Absence&quot;, data=&quot;Surveys&quot;, source=&quot;Urchin survey&quot;, 
                             group=&quot;Surveys: Absence&quot;, year=NA, research=&quot;Bottom sample&quot;)
urchinA &lt;- st_transform(urchinA[,-c(1:20, 22)], crs=8088)

hellisfj &lt;- read_sf(dsn=&quot;Hellisfjordur3057.kml&quot;)
hellisfjA &lt;- hellisfj %&gt;% filter(maerl==0)
hellisfjP &lt;- hellisfj %&gt;% filter(maerl!=0)

hellisfjA &lt;- hellisfjA%&gt;% mutate(type=&quot;Absence&quot;, data=&quot;Surveys&quot;, 
                                 source=&quot;Maerl survey&quot;, group=&quot;Surveys: Absence&quot;,
                                 year=2022, research=&quot;Video survey&quot;)
hellisfjA &lt;- st_transform(hellisfjA[, -c(1:13)], crs=8088)

hellisfjP &lt;- hellisfjP%&gt;% mutate(type=&quot;Presence&quot;, data=&quot;Surveys&quot;, source=&quot;Maerl survey&quot;, 
                                 group=&quot;Surveys: Presence&quot;,
                                 year=2022, research=&quot;Video survey&quot;)
hellisfjP &lt;- st_transform(hellisfjP[, -c(1:13)], crs=8088)

holmanes &lt;- read_sf(dsn=&quot;HolmanesSurvey3057.kml&quot;)
holmanesA &lt;- holmanes %&gt;% filter(maerl==0)
holmanesP &lt;- holmanes %&gt;% filter(maerl!=0)

holmanesA &lt;- holmanesA%&gt;% mutate(type=&quot;Absence&quot;, data=&quot;Surveys&quot;, source=&quot;Maerl survey&quot;, 
                                 group=&quot;Surveys: Absence&quot;,
                                 year=2022, research=&quot;Video survey&quot;)
holmanesA &lt;- st_transform(holmanesA[, -c(1:13)], crs=8088)

holmanesP &lt;- holmanesP%&gt;% mutate(type=&quot;Presence&quot;, data=&quot;Surveys&quot;, source=&quot;Maerl survey&quot;, 
                                 group=&quot;Surveys: Presence&quot;,
                                 year=2022, research=&quot;Video survey&quot;)
holmanesP &lt;- st_transform(holmanesP[, -c(1:13)], crs=8088)

grimaA &lt;- read_sf(dsn=&quot;GrimaA.kml&quot;)
grimaP &lt;- read_sf(dsn=&quot;GrimaP.kml&quot;)

grimaA &lt;- grimaA%&gt;% mutate(type=&quot;Absence&quot;, data=&quot;Surveys&quot;, 
                           source=&quot;Náttúrufræðistofa Austurlands survey&quot;, group=&quot;Surveys: Absence&quot;,
                           year=2022, research=&quot;Video survey&quot;)
grimaP &lt;- grimaP%&gt;% mutate(type=&quot;Presence&quot;, data=&quot;Surveys&quot;, 
                           source=&quot;Náttúrufræðistofa Austurlands survey&quot;, group=&quot;Surveys: Presence&quot;,
                           year=2022, research=&quot;Video survey&quot;)

grimaA &lt;- st_transform(grimaA[, -c(1:13)], crs=8088)
grimaP &lt;- st_transform(grimaP[, -c(1:16)], crs=8088)

nordfjA &lt;- read_sf(dsn=&quot;NordfjA.kml&quot;)
nordfjP &lt;- read_sf(dsn=&quot;NordfjP.kml&quot;)

## Need to check if year and research type is correct

nordfjA &lt;- nordfjA%&gt;% mutate(type=&quot;Absence&quot;, data=&quot;Surveys&quot;, 
                             source=&quot;Náttúrufræðistofa Austurlands survey&quot;, 
                             group=&quot;Surveys: Absence&quot;,
                             year=2022, research=&quot;Video survey&quot;)
nordfjP &lt;- nordfjP%&gt;% mutate(type=&quot;Presence&quot;, data=&quot;Surveys&quot;, 
                             source=&quot;Náttúrufræðistofa Austurlands survey&quot;, 
                             group=&quot;Surveys: Presence&quot;,
                             year=2022, research=&quot;Video survey&quot;)

nordfjA &lt;- st_transform(nordfjA[, -c(1:16)], crs=8088)
nordfjP &lt;- st_transform(nordfjP[, -c(1:16)], crs=8088)

setwd(&quot;~/MappingData/LiteratureMaps/ForR&quot;)


# Fixing coordinates

valA&lt;-st_as_sf(valA, coords= c(&quot;x&quot;, &quot;y&quot;), crs=8088)
valP&lt;-st_as_sf(valP, coords= c(&quot;x&quot;, &quot;y&quot;), crs=8088)
natA&lt;-st_as_sf(natA, coords= c(&quot;x&quot;, &quot;y&quot;), crs=8088)
natP&lt;-st_as_sf(natP, coords= c(&quot;x&quot;, &quot;y&quot;), crs=8088)
divers&lt;-st_as_sf(divers, coords=c(&quot;x&quot;, &quot;y&quot;), crs=8088)

# Binding groups

point&lt;-rbind(adalP, adalA, natA, natP, 
             th80P, th80A, valA, valP, eiretalA, 
             eiretalP, eirtho03A, eirtho04A, eirtho04P, 
             eirtho12A, eirtho13A, gallo15A, gallo21A,
             gallo21P, galloetal21A, helgA, leuA, leuP, 
             heletalA, johetalA, johstefgud15A, johstefgud15P, 
             grimaA, grimaP, nordfjA, nordfjP, divers)
point &lt;- st_transform(point, crs=4326)
point &lt;- point %&gt;%
  mutate(lon = unlist(map(point$geometry,1)),
         lat = unlist(map(point$geometry,2)))

line&lt;-rbind(iskA, th18PL, thors11A, urchinP, urchinA, hellisfjA, hellisfjP, holmanesA, holmanesP)
line &lt;- st_transform(line, crs=4326)

poly&lt;-rbind(gunnP, iskP, th18PP, simbi, einarp, natAustA, natAustP, thors11P)
poly &lt;- st_transform(poly, crs=4326)


# Label content

point$content &lt;- lapply(paste(&quot;Source:&quot;,point$source,&quot;&lt;br&gt;&quot;,
                              &quot;Data type:&quot;, point$type,&quot;&lt;br&gt;&quot;,
                              &quot;Source type:&quot;,point$data), htmltools::HTML)
line$content &lt;- lapply(paste(&quot;Source:&quot;,line$source,&quot;&lt;br&gt;&quot;,
                             &quot;Data type:&quot;, line$type,&quot;&lt;br&gt;&quot;,
                             &quot;Source type:&quot;,line$data), htmltools::HTML)
poly$content &lt;- lapply(paste(&quot;Source:&quot;,poly$source,&quot;&lt;br&gt;&quot;,
                             &quot;Data type:&quot;, poly$type,&quot;&lt;br&gt;&quot;,
                             &quot;Source type:&quot;,poly$data), htmltools::HTML)

point$source &lt;- if_else(grepl(&quot;Alex Tyas&quot;, point$source)==TRUE, &quot;Alex Tyas : Diver&quot;, point$source)


# Define color codes and palette
pap &lt;- factor(c(1:5), labels = c(&quot;Surveys: Presence&quot;,
                                 &quot;Literature: Presence&quot;,
                                 &quot;Divers&quot;,
                                 &quot;Surveys: Absence&quot;,
                                 &quot;Literature: Absence&quot;))

pal &lt;- colorFactor(palette = c(&quot;chartreuse&quot;, &quot;chartreuse3&quot;, &quot;chartreuse4&quot;, &quot;firebrick1&quot;, &quot;firebrick&quot;),
                   domain = pap, ordered = F)

# UI function for the Shiny app
ui &lt;- fluidPage(
  titlePanel(&quot;Maerl Map&quot;),
  fluidRow(
    column(3,
           checkboxGroupButtons(
             inputId = &quot;typeSelector&quot;,
             label = &quot;Data type&quot;,
             choices = c(&quot;Presence&quot;, &quot;Absence&quot;),
             selected = &quot;Presence&quot;
           ),
           br(),
           checkboxGroupButtons(
             inputId = &quot;researchSelector&quot;,
             label = &quot;Research type&quot;,
             choices = c(&quot;Video survey&quot;, &quot;Bottom sample&quot;, &quot;Multibeam echosample&quot;, &quot;Dive&quot;),
             selected = c(&quot;Video survey&quot;, &quot;Bottom sample&quot;)
           ),
           br(),
           checkboxGroupButtons(
             inputId = &quot;dataSelector&quot;,
             label = &quot;Source type&quot;,
             choices = c(&quot;Surveys&quot;, &quot;Literature&quot;, &quot;Divers&quot;),
             selected = &quot;Surveys&quot;
           )
    ),
    column(9, leafletOutput(&quot;map&quot;))
  )
)

# Server function for the Shiny app
server &lt;- function(input, output) {# Filter the data based on the selected checkboxes
    point2 &lt;- reactive({point %&gt;%
      filter(type %in% input$typeSelector &amp; research %in% input$researchSelector &amp; data %in% input$dataSelector)
    })
    line2 &lt;- reactive({filtered_line &lt;- line %&gt;%
      filter(type %in% input$typeSelector &amp; research %in% input$researchSelector &amp; data %in% input$dataSelector)
    })
    poly2 &lt;- reactive({filtered_poly &lt;- poly %&gt;%
      filter(type %in% input$typeSelector &amp; research %in% input$researchSelector &amp; data %in% input$dataSelector)
    })

  output$map &lt;- renderLeaflet({
    map_layers &lt;- function() {
      
      #number of groups
      k &lt;- levels(factor(point2()$source))
      j &lt;- levels(factor(line2()$source))
      l &lt;- levels(factor(poly2()$source))
      
      #base map
      proj &lt;- &quot;+proj=laea +lat_0=52 +lon_0=10 +x_0=4321000 +y_0=3210000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs&quot;
      
      crs &lt;- leafletCRS(
        code = &quot;EPSG:9039&quot;,
        proj4def = proj)
      
      
      map&lt;- leaflet(leafletOptions(crs=crs)) %&gt;% 
        addTiles()
      
      #loop through all groups and add a layer one at a time
      for (i in k) {
        map &lt;- map %&gt;% 
          addCircleMarkers(
            data = point2() %&gt;% filter(source == i), 
            lng = ~lon, lat = ~lat, radius = 1, 
            color=~pal(group), 
            opacity = 0.8,
            group = i
          )
      }
      for (i in j) {
        map &lt;- map %&gt;% 
          addPolylines(
            data = line2() %&gt;% filter(source == i),
            color=~pal(group), 
            opacity = 0.8,
            highlightOptions = 
              highlightOptions(color = &quot;white&quot;, 
                               weight = 2,
                               bringToFront = TRUE),
            group = i
          )
      }
      for (i in l) {
        map &lt;- map %&gt;% 
          addPolygons(
            data = poly2() %&gt;% filter(source == i), 
            color=~pal(group),
            opacity = 0.8,
            fillColor = ~pal(group),
            fillOpacity = 0.5,
            highlightOptions = 
              highlightOptions(color = &quot;white&quot;, 
                               weight = 2,
                               bringToFront = TRUE),
            group = i
          )
      }
      
      s &lt;- c(k,j,l)
      
      #create layer control
      map %&gt;% 
        addLayersControl(
          overlayGroups = s,
          options = layersControlOptions(collapsed = TRUE)) %&gt;%
        addLegend(&quot;bottomleft&quot;, pal = pal, values = pap,
                  title = &quot;Source&quot;,
                  opacity = 1)
    }
    
    map_layers()
    
  })
}

# Run the Shiny app
shinyApp(ui, server)</code></pre>
<iframe data-deferred-src="app6308982e6d55113333fd0c013a27e32b/?w=&amp;__subapp__=1" width="100%" height="400" class="shiny-frame shiny-frame-deferred"></iframe>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
